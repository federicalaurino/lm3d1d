% SIAM Article Template
\documentclass[r]{siamart171218}
% Packages and macros go here
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{array}
\usepackage{graphicx}
\usepackage{epsfig}
\usepackage{float}
\usepackage{fullpage}
\usepackage{color}
\usepackage{enumitem}  
\usepackage{epstopdf}
\usepackage{stmaryrd}

% Title. If the supplement option is on, then "Supplementary Material"
% is automatically inserted before the title.
%\title{On the weak coupling of 3D and 1D second order elliptic problems}
\title{Coupling PDEs on 3D-1D domains with Lagrange multipliers}

% Authors: full names plus addresses.
\author{Miroslav Kuchta, Federica Laurino, Kent-Andre Mardal, Paolo Zunino,\thanks{Authors are listed in alphabetical order}}

\begin{document}

\maketitle

% REQUIRED
\begin{abstract}
These are personal notes written to keep track of the developments on this topic, to be kept confidential.
\end{abstract}

% REQUIRED
\begin{keywords}
elliptic problems, high dimensionality gap, essential coupling conditions, Lagrange multipliers
\end{keywords}

% REQUIRED
\begin{AMS}
n.a.
\end{AMS}

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 
% definitions here

\def\ud{u_{\odot}}
\def\udh{u_{\odot, h}}
\def\vd{v_{\odot}}
\def\uf{u_{\ominus}}
\def\up{u_{\oplus}}
\def\eps{\epsilon}
\def\nn{\boldsymbol n}
\def\rr{\boldsymbol r}
\def\RR{\boldsymbol R}
\def\kk{\boldsymbol k}
\def\ss{\boldsymbol s}
\def\uu{\boldsymbol u}
\def\vv{\boldsymbol v}
\def\xx{\boldsymbol x}
\def\bu{\overline{u}}
\def\bv{\overline{v}}
\def\tu{\widetilde{u}}
\def\tv{\widetilde{v}}
\def\TT{\boldsymbol T}
\def\NN{\boldsymbol N}
\def\BB{\boldsymbol B}
\def\ttu{\widetilde{\widetilde{u}}}
\def\ttv{\widetilde{\widetilde{v}}}
\def\cv{\check{v}}
\def\mesh{{\cal T}^h}
\def\ball{{\cal B}}
\def\R{\mathbb{R}}
\def\D{\mathcal{D}}
\def\DD{\partial\mathcal{D}}
\def\trace{\overline{\mathcal{R}}}
\def\ext{\mathcal{E}}
\def\ide{\mathcal{I}}
\def\ii{\hat{\imath}}
\newcommand{\avrd}[1]{\overline{\overline{#1}}}
\newcommand{\avrc}[1]{\overline{#1}}
\newcommand{\refe}[1]{{#1}_{\mathrm{ref}}}
\newcommand{\norm}[1]{\lVert{#1}\rVert}

\newcommand{\vertiii}[1]{{\left\vert\kern-0.25ex\left\vert\kern-0.25ex\left\vert #1 
    \right\vert\kern-0.25ex\right\vert\kern-0.25ex\right\vert}}

\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}{Property}[section]
\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]
 
% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\section{Introduction}\label{sec:intro}

We address the geometrical configuration of the problem for a 3D coupled problem formulation based on from Dirichlet-Neumann interface conditions. Then, we apply a model reduction technique that transforms the problem into 3D-1D coupled PDEs. We develop and analyze a robust definition of the coupling operators form a 3D domain, $\Omega$, to 1D manifold, $\Lambda$, and vice versa. This is a non trivial objective because the standard trace operator form a domain $\Omega$ to a subset $\Lambda$ is not well posed if $\Lambda$ is a manifold of co-dimension two of $\Omega$.

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\section{Problem setting}\label{sec:setting}

Let $\Omega \subset \mathbb{R}^3$ be a bounded, convex open set. Let $\Sigma$ be a generalized cylinder embedded into $\Omega$ and be $\Omega_\oplus = \Omega \setminus \overline{\Sigma}$ be the complementary set of the cylinder. We also introduce the set $\Lambda$, a 1D manifold that is the centerline of $\Sigma$. We define the arc-length coordinate along $\Lambda$, denoted by $s \in (0,S)$. We denote with $\mathcal{D}(s)$ and $\partial\mathcal{D}(s)$ a cross section of $\Sigma$ and its boundary, respectively. In what follows, we assume for simplicity of notation that $\Sigma$ has a constant cross section, but this is not a restriction of the approach. We also assume that $\Sigma$ crosses $\Omega$ from side to side and we call $\Gamma$ the lateral (cylindrical) surface of $\Sigma$, while the upper and lower side faces of $\Sigma$ belong to $\partial\Omega$. We refer to Figure \ref{fig1} for an illustration of the notation. 

\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{3D-1D-simple.png}
\end{center}
\caption{Geometrical setting of the problem}
\label{fig1}
\end{figure}

We consider the problem arising from \emph{Dirichlet-Neumann} conditions. 
It consists to find $\up,\uf$ s.t.:
\begin{subequations}\label{eq:dirneu}
\begin{align}
\label{eq:dirneu1}
- \Delta \up  + \up &= f  && \text{ in } \Omega_{\oplus},\\
\label{eq:dirneu2}
- \Delta \uf  + \uf &= g  && \text{ in } \Sigma,\\
\label{eq:dirneu3}
-\nabla \uf \cdot \nn_{\ominus} &= -\nabla \up \cdot \nn_{\ominus}  && \text{ on } \Gamma,\\
\label{eq:dirneu4}
\uf &= \up && \text{ on }  \Gamma,\\
\label{eq:dirneu5}
\up &= 0 && \text{ on } \partial \Omega\,.
\end{align}
\end{subequations}

The objective of this work is to derive and alalyze a simplified version of problem \eqref{eq:dirneu}, where the domain $\Sigma$ shrinks to its centerline $\Lambda$ and the corresponding partial differential equation is averaged on the cylinder cross section, namely $\mathcal{D}$. This new problem setting will be called the \emph{reduced} problem. Form the mathematical standpoint it is more challenging than \eqref{eq:dirneu}, because it involves the coupling of 3D/1D elliptic problems.
For the model reduction process, we decompose integrals as follows, for any sufficiently regular function $w$,
\begin{equation*}
\int_\Sigma w d\omega 
= \int_\Lambda \int_{\mathcal{D}} w d\sigma ds
= \int_\Lambda |\mathcal{D}|\avrd{w} ds\,,
\quad
\int_{\Gamma} w d\sigma 
= \int_\Lambda \int_{\partial\mathcal{D}} w d\gamma ds
= \int_\Lambda  |\partial \mathcal{D}| \avrc{w} ds\,,
\end{equation*}
where $\avrd{w}, \ \avrc{w}$ denote the following mean values respectively,
\begin{equation*}
\avrd{w} = |\mathcal{D}|^{-1} \int_{\mathcal{D}} w d\sigma\,,
\quad
\avrc{w} = |\partial\mathcal{D}|^{-1} \int_{\partial\mathcal{D}} w d\gamma\,.
\end{equation*}

We apply the model reduction approach at the level of the variational formulation.
We start from the variational formulation of problem \eqref{eq:dirneu}, 
that is to find $\up \in H^1_{\partial\Omega}(\Omega_\oplus), \ \uf \in H^1_{\partial\Sigma\setminus\Gamma}(\Sigma), \ \lambda \in H^{-\frac12}(\partial\Sigma)$ s.t.
\begin{subequations}\label{eq:weak_dirneu}
\begin{align}
&(u_\oplus,v_\oplus)_{H^1(\Omega_\oplus)} + (u_\ominus,v_\ominus)_{H^1(\Sigma)} 
+ \langle v_\ominus - v_\oplus, \lambda \rangle_{H^{-\frac12}(\Gamma)} 
\\
\nonumber
&\qquad\qquad = (f,v_\oplus)_{L^2(\Omega_\oplus)} + (g,v_\ominus)_{L^2(\Sigma)}
\quad \forall v_\oplus \in H^1_{\partial\Omega}(\Omega_\oplus), \ v_\ominus \in H^1_{\partial\Sigma\setminus\Gamma}(\Sigma)
\\
& \langle u_\ominus - u_\oplus, \mu \rangle_{H^{-\frac12}(\Gamma)} = 0
\quad \forall  \mu \in H^{-\frac12}(\Gamma)\,,
\end{align}
\end{subequations}
where $\langle v, \mu \rangle_{H^{-\frac12}(\Gamma)}$ denotes the duality pairing between 
$ \mu \in H^{-\frac12}(\Gamma)$ and $v \in H^{\frac12}(\Gamma)$.
In this case, the additional variable $\lambda$ is equivalent to $\lambda  = - \nabla \uf \cdot \nn_\ominus$.

Using the averaging tools for the model reduction approach, we end up with a reduced problem
for the unknown $u$ defined on the entire 3D domain $\Omega$, coupled with the unknown $\ud$, defined on the 1D manifold $\Lambda$
and a Lagrange multiplier $L$ defined on $\Lambda$. In the reduced problem the multiplier assumes the following interpretation,
\begin{equation*}
L = - \frac{1}{|\partial{\cal D}|} \int_{\partial{\cal D}} \nabla \uf \cdot \nn_\ominus
   = - \frac{1}{|\partial{\cal D}|} \int_{\partial{\cal D}} \lambda \,.
\end{equation*}

We consider two alternative formulations. The scope of this work is to compare them, 
with the aim to determine which is the most suitable as a computational model based on 3D-1D coupled PDEs.

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Problem 1}
The idea is to couple a 3D PDE with a 1D one, using a Lagrange multiplier space defined on a 2D surface that surrounds the 1D manifold.
Let $\langle \cdot , \cdot \rangle_\Gamma$ denote the duality pairing between 
$H^\frac12_{00}(\Gamma)$ and $H^{-\frac12}(\Gamma)$.
The problem consists to find $u \in H^1_0(\Omega),\ \ud \in H^1_0(\Lambda), \ L \in H^{-\frac12}(\Gamma )$, such that
\begin{subequations}\label{eq:problem1}
\begin{align}
&(u,v)_{H^1(\Omega)} + |{\cal D}|(\ud,\vd)_{H^1(\Lambda)} 
+ \langle \Pi_1 v  - \Pi_2 \vd, L \rangle_\Gamma
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} + |{\cal D}| (\avrd{g},\vd)_{L^2(\Lambda)}
\quad \forall v \in H^1_0(\Omega), \ \vd \in H^1(\Lambda)
\\
&   \langle \Pi_1 u - \Pi_2 \ud , M \rangle_\Gamma = 0
\quad \forall M \in H^{-\frac12}(\Gamma)\,.
\end{align}
\end{subequations}
Here, $\Pi_1: H^1_0(\Omega) \rightarrow H^{\frac12}_{00}(\Gamma)$
and $\Pi_2: H^1_0(\Lambda) \rightarrow H^{\frac12}_{00}(\Gamma)$
and we remark that $\Sigma$ may be considered as a virtual surface
not necessarily of the same size as the underlying physical structure that is modeled.  
The $\Pi_1$ and $\Pi_2$ operators may be defined in terms of the averaging operators above, but may also be realized in terms of e.g. Green functions (I don't know if this is a good idea). Furthermore,  $\Gamma$ may be discretized in terms of facets neighboring $\Lambda$ and may as such not be represented as a separate structure in the implementation. 

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Problem 2}
Another form of the reduced problem uses Lagrange multipliers defined directly on the 1D manifold.
In this case, $\langle \cdot , \cdot \rangle_\Lambda$ denotes the duality pairing between 
$H^\frac12_{00}(\Lambda)$ and $H^{-\frac12}(\Lambda)$.
The problem requires to find $u \in H^1_0(\Omega),\ \ud \in H^1_0(\Lambda), \ L \in H^{-\frac12}(\Lambda)$, such that
\begin{subequations}\label{eq:problem2}
\begin{align}
&(u,v)_{H^1(\Omega)} + |{\cal D}|(\ud,\vd)_{H^1(\Lambda)} 
+ |\partial {\cal D}| \langle \Pi_1 v - \Pi_2 \vd, L \rangle_{H^{-\frac12}(\Lambda)} 
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} + |{\cal D}| (\avrd{g},V)_{L^2(\Lambda)}
\quad \forall v \in H^1_0(\Omega), \ \vd \in H^1_0(\Lambda)
\\
&  |\partial {\cal D}| \langle \Pi_1 u -  \Pi_2 \ud, M \rangle_{H^{-\frac12}(\Lambda)} = 0
\quad \forall M \in H^{-\frac12}(\Lambda)\,.
\end{align}
\end{subequations}
We notice that all the integrals of the reduced problem are well defined because $u,v \in H^1_0(\Omega)$, 
$u,v|_{\Gamma} \in H^\frac12_{00}(\Gamma)$ and thus $\avrc{u},\avrc{v} \in H^\frac12_{00}(\Lambda)$.
More precisely, $\Pi_1 : H^1_0(\Omega) \rightarrow H^\frac12_{00}(\Lambda$ such that
$\Pi_1 u = \avrc{(u|_\Gamma)}$ is the combination between the trace on $\Gamma$ and the average on $\partial{\cal D}$.
The operator $\Pi_2: H^1_0(\Lambda) \rightarrow H^\frac12_{00}(\Lambda)$ is the injection form $H^1_0(\Lambda)$ and $H^\frac12_{00}(\Lambda)$.
It is apparent that problems \eqref{eq:weak_dirneu} and \eqref{eq:red_dirneu} share the same mathematical structure.
For this reason, the well-posedness of \eqref{eq:red_dirneu} can be studied in the framework of the classical theory of saddle point problems.

%Assuming now that 
%$\Pi_1: H^1(\Omega) \rightarrow H^{\frac12}(\Gamma)$ or $\Pi_2: H^1(\Gamma) \rightarrow H^{\frac12}(\Gamma)$ are isomorphisms in the sense that 
%\[
%\| \Pi_1 \|_{L(H^1(\Omega), H^{\frac12}(\Gamma))} \le C \mbox{, } 
%\| \Pi_1^{-1} \|_{L(H^{\frac12}(\Gamma), H^1(\Omega))} \le 1/c,  
%\]
%and 
%\[
%\| \Pi_2 \|_{L(H^1(\Omega), H^{\frac12}(\Gamma))} \le C \mbox{, } 
%\| \Pi_2^{-1} \|_{L(H^{\frac12}(\Gamma), H^1(\Omega))} \le 1/c .   
%\]
%We obtain the inf-sup condition as follows. Assume that $\Pi_1$ is an isomorphism then  
%we may show the inf-sup conditioning by letting $\Pi_1 \hat u = M $ and $ \hat \ud = 0$ (i.e., we need the lower bound only for one
%of the operators).  
%\begin{eqnarray}
%\sup_{u,\ud}\frac{
%\langle \Pi_1 u - \Pi_2 \ud , M \rangle_{(H^{\frac12}(\Gamma), H^{-\frac12}(\Gamma))} 
%}{(|u|_1^2 + |\ud|_1^2)^{1/2}} 
%\ge \\ 
%\frac{ \langle \Pi_1 \hat u - \Pi_2 \hat \ud , M \rangle_{(H^{\frac12}(\Gamma), H^{-\frac12}(\Gamma))} 
%}{(|\hat u|_1^2 + |\hat \ud|_1^2)^{1/2}}  \ge \\
%\frac{ \langle M , M \rangle_{(H^{\frac12}(\Gamma), H^{-\frac12}(\Gamma))} 
%}{|\Pi_1^{-1} M |_{H^1(\Omega})} \ge \\ 
%\frac{ \langle M , M \rangle_{(H^{\frac12}(\Gamma), H^{-\frac12}(\Gamma))} 
%}{| M |_{H^\frac12(\Gamma)}} \ge \\ 
%c | M |_{H^{-\frac12}(\Gamma)}  
%\end{eqnarray}
%I think the other Brezzi conditions also follows, but for the boundedness we
%would need that both $\Pi_1$ and $\Pi_2$ are bounded. Not sure I am 
%happy with the $\langle \cdot, \cdot \rangle$ notation and in particular not when we spesify the
%spaces. I would rather just say that $(\cdot, \cdot)$ denotes both the $L_2$ inner product and the
%duality pairing.  
%If we find it useful we may also  
%consider $\Pi_2: H^1(\Gamma) \rightarrow X(\Gamma)$ where $X$ may e.g. be $H^1$.  
%If so, $L, M$ in $ H^{-\frac12}(\Gamma) \cap X(\Gamma)$  

\input{infsup}

\input{infsup_discrete}

\section{A benchmark problem with analytical solution}


Let $\Omega=[0,1]^3$, $\Lambda=\{x=\tfrac{1}{2}\}\times \{y=\tfrac{1}{2}\} \times [0,1] $
and $\Sigma=[\tfrac{1}{4}, \tfrac{3}{4}]\times [\tfrac{1}{4}, \tfrac{3}{4}]\times [0, 1]$.
Finally we let $\DD$ be the cross section of the virtual interface $\Gamma=\partial \Sigma$.
As a benchmark for the two formulations we consider the following coupled problems
%
\begin{subequations}\label{benchmark}
\begin{align}
\label{benchm_3d}
-\Delta u=f \quad &\text{in $\Omega$}\\
\label{benchm_1d}
-d_{zz}^2 \ud =g \quad &\text{on $\Lambda$}\\
u=h \quad &\text{on $\partial \Omega$},
\end{align}
\end{subequations}
where for formulation \eqref{eq:problem1} the mix-dimensional coupling constraint reads
\begin{equation}
  \label{eq:couple_1}
\mathcal{T}_{\Gamma}u - \mathcal{E}_{\Gamma}\ud = q_1\quad\text{ on }\Gamma,
\end{equation}
while for \eqref{eq:problem2} we set
\begin{equation}
    \label{eq:couple_2}
\avrc{u} - \ud = q_2\quad\text{ on }\Lambda.
\end{equation}
%
In \eqref{benchmark}-\eqref{eq:couple_2} the right-hand side data shall be defined as 
\begin{eqnarray*}
  &f=8\pi ^2 \sin (2\pi x) \sin (2\pi y),\quad &g={\pi ^2}\sin \left({\pi z}\right),\quad h=\sin (2\pi x) \sin (2\pi y),\\
  &q_1=\sin (2\pi x) \sin (2\pi y) - \sin \left({\pi z}\right),\quad &q_2=-\sin \left({\pi z}\right).
\end{eqnarray*}

The exact solution of \eqref{benchmark}, regardless of the coupling constraint,
is given by
%
\begin{eqnarray}
\label{benchm_sol3d}
u=\sin (2\pi x) \sin (2\pi y)\\
\label{benchm_sol1d}
%\ud=1+\exp(-z).
\ud=\sin \left({\pi z}\right).
\end{eqnarray}
%
Let us notice that $\ud$ satisfies homogeneous Dirichlet conditions at the boundary of $\Lambda$.
Moreover, the solution \eqref{benchm_sol3d}-\eqref{benchm_sol1d} satisfies on $\Gamma$ the relation
\begin{equation}\label{benchm_flux}
\lambda=\nabla u \cdot \textbf{n}_{\oplus}=d_z \ud n_{\oplus,z}=0,
\end{equation}
with $n_{\oplus,z}$ the $z-$component of the normal unit vector to $\Gamma$.

We prove that \eqref{benchmark} is solution of \eqref{eq:problem2} in the
simplified case in which the starting 3D-3D problem is
\begin{subequations}\label{eq:dirneu_simple}
\begin{align}
- \Delta \up  &= f  && \text{ in } \Omega_{\oplus},\\
- \Delta \uf &= g  && \text{ in } \Sigma,\\
-\nabla \uf \cdot \nn_{\ominus} &= -\nabla \up \cdot \nn_{\ominus}  && \text{ on } \Gamma,\\
\uf - \up &= q_i  && \text{ on }  \Gamma,\\
\up &= h && \text{ on } \partial \Omega.
\end{align}
\end{subequations}
instead of \eqref{eq:dirneu}. Therefore the reduced problem in \eqref{eq:problem1} and
\eqref{eq:problem2} become respectively
%
\begin{subequations}\label{eq:problem1_simple}
\begin{align}
\label{eq:problem1_simple_eq1}
&(\nabla u,\nabla v)_{L^2(\Omega)} + |{\cal D}|(d_s \ud,d_s \vd)_{L^2(\Lambda)} 
+ \langle \mathcal{T}_{\Gamma} v  - \mathcal{E}_{\Gamma} \vd, L \rangle_\Gamma
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} + |{\cal D}| (\avrd{g},\vd)_{L^2(\Lambda)}
\quad \forall v \in H^1_0(\Omega), \ \vd \in H^1_0(\Lambda)
\\
\label{eq:problem1_simple_eq2}
&   \langle \mathcal{T}_{\Gamma} u - \mathcal{E}_{\Gamma} \ud , M \rangle_\Gamma =  \langle q_1 , M \rangle_\Gamma
\quad \forall M \in H^{-\frac12}(\Gamma)\,.
\end{align}
\end{subequations}
and
\begin{subequations}\label{eq:problem2_simple}
  \begin{align}
    \label{eq:problem2_simple_eq1}
&(\nabla u,\nabla v)_{L^2(\Omega)} + |{\cal D}|(d_s \ud,d_s \vd)_{L^2(\Lambda)} 
+ |{\partial \cal D}| \langle \avrc{v} - \vd, L \rangle_{H^{-\frac12}(\Lambda)} 
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} + |{\cal D}| (\avrd{g},V)_{L^2(\Lambda)}
\quad \forall v \in H^1_0(\Omega), \ \vd \in H^1_0(\Lambda)
\\
\label{eq:problem2_simple_eq2}
&  |\partial {\cal D}| \langle \avrc{u} -  \ud, M \rangle_{H^{-\frac12}(\Lambda)} =
|\partial {\cal D}| \langle \avrc{q_2}, M \rangle_{H^{-\frac12}(\Lambda)}
\quad \forall M \in H^{-\frac12}(\Lambda)\,.
\end{align}
\end{subequations}

Let us prove that \eqref{benchm_sol3d}-\eqref{benchm_sol1d} is solution of
\eqref{eq:problem2_simple}. Using the integration by part formula and homogeneous
boundary conditions on $\Omega$ and $\Lambda$, from \eqref{eq:problem2_simple_eq1} we have
\begin{align*}
&-(\Delta u, v)_{L^2(\Omega)} - |{\cal D}|(d^2_{ss} \ud, \vd)_{L^2(\Lambda)} 
+ |{\cal D}|\langle \avrc{v}  - \vd, L \rangle_\Lambda
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} + |{\cal D}| (\avrd{g},\vd)_{L^2(\Lambda)}
\quad \forall v \in H^1_0(\Omega), \ \vd \in H^1(\Lambda).
\\
\end{align*}
Since $L=\avrc{\lambda}=0$ and \eqref{benchm_sol3d} satisfies \eqref{benchm_3d} and \eqref{benchm_sol1d}
satisfies \eqref{benchm_1d}, we have that
\begin{align*}
-(\Delta u, v)_{L^2(\Omega)} =  (f,v)_{L^2(\Omega)} \\
-|{\partial \cal D}|(d^2_{ss} \ud, \vd)_{L^2(\Lambda)}  = |{\cal D}| (\avrd{g},\vd)_{L^2(\Lambda)},
\end{align*}
Thus \eqref{benchm_sol3d}-\eqref{benchm_sol1d} satisfy \eqref{eq:problem2_simple_eq1}.
The fact that the solution satisfy \eqref{eq:problem2_simple_eq2} follows from \eqref{eq:couple_2}.

We can prove in a similar way that \eqref{benchm_sol3d}-\eqref{benchm_sol1d}, with $L=\lambda=0$
satisfy \eqref{eq:problem1_simple}. Note in particular that $q_1$ is such that
$\mathcal{T}_{\Gamma}u - \mathcal{E}_{\Gamma}\ud = q_1$ on $\Gamma$.

\subsection{Numerical experiments} Using the benchmark problem \eqref{benchmark}
we now investigate convergence properties of the two formulations. To this
end we consider a \emph{uniform} tessilation of $\mathcal{T}^{\Omega}_h$ of $\Omega$ consisting of
tetrahedra with diameter $h$. Further, the discretization shall be
geometrically \emph{conforming} to both $\Lambda$ and $\Gamma$ such that
the tessilations $\mathcal{T}^{\Gamma}_h$, $\mathcal{T}^{\Lambda}_h$ are made up
of facets and edges of $\mathcal{T}^{\Omega}_h$ respectively, cf. Figure \ref{fig:mesh}
for illustration.

\begin{figure}
  \begin{center}
    \includegraphics[width=0.5\textwidth]{./conform_mesh.pdf}
    \caption{$\Lambda$ and $\Gamma$ conforming discretization of $\Omega$
      used for \eqref{eq:problem1_simple}. For \eqref{eq:problem2_simple}
      only conformity to $\Lambda$ is needed.
    }
    \label{fig:mesh}
  \end{center}
\end{figure}
  
Formulations \eqref{eq:problem1_simple} and \eqref{eq:problem2_simple} shall
be discretized using contiuous Lagrange element of order 1 ($P_1$) for all the spaces
involved. We recall that since are are investigating the conforming case, the tripplet
$P_1$-$P_1$-$P_1$ satisfies
the discrete inf-sup condition. The resulting linear systems are solved
using the minimal residual method (MinRes) with stopping criterion requiring the relative
preconditioned residual norm to be less than $10^{-12}$. As the preconditioner
we use the (approximate) Riesz mapping with respect to the inner products of
the spaces in which the two formulations were proved to be well posed.
In particular, the preconditioner for the Lagrange multiplier relies on
(the inverse of) the fractional Laplacian $-\Delta^{-1/2}$ on $\Gamma$ for
\eqref{eq:problem1_simple} and $\Lambda$ for \eqref{eq:problem2_simple}.
We remark that the size of the linear systems on the finest meshes considered
here prevents the use direct solvers. Therefore iterative solvers were necessary. 

Considering uniform refinements of the initial mesh, Table \ref{tab:error_conform}
lists the errors of formulations \eqref{eq:problem1_simple} and \eqref{eq:problem2_simple}
on the benchmark problem. It can be seen the error in $u$ and $\ud$ in $H^1$ norm
converges linearly (as can be expected due to $P_1$ element discretization).
Moreover, the error of the Lagrange multiplier approximation in $H^{-1/2}$ norm
decreases quadratically. In the light of $P_1$ discretization this rate appears
superconvergent. We speculate that the result is due to the fact that the
exact solution is particularly simple, $L=0$. In case of the results for
\eqref{eq:problem1_simple} the rate can also be due to the fact that the
error is interpolated into the same finite element space as the approximation $L_h$.
We remark that for $u$ and $\ud$ the error is interpolated into FE space of piecewise
quadratic \emph{discontinous} functions. For \eqref{eq:problem2_simple} we
evaluate the fractional norm and interpolate the error using piecewise continuous
cubic functions. Evaluating the fractional norm in higher order spaces
for formulation with the multiplier space on $\Gamma$ is prohibitively costly. 

%
\begin{table}
  \scriptsize{
    \begin{minipage}{0.49\textwidth}
  \begin{center}
    \begin{tabular}{c|ccc}
      \hline
    $h$ & $\norm{u-u_h}_{1, \Omega}$ & $\norm{\ud-\udh}_{1, \Lambda}$ & $\norm{L-L_h}_{-1/2,\Gamma}$\\
      \hline
4.3E-1 & 3.4E0(--) & 5.3E-1(--) & 2.9E0(--)\\
2.2E-1 & 1.7E0(0.99) & 2.6E-1(1.06) & 6.1E-1(2.25)\\
1.1E-1 & 8.7E-1(0.99) & 1.3E-1(1.02) & 1.4E-1(2.13)\\
5.4E-2 & 4.4E-1(1.00) & 6.3E-2(1.00) & 3.4E-2(2.03)\\
2.7E-2 & 2.2E-1(1.00) & 3.1E-2(1.00) & 8.6E-3(2.00)\\
\hline
  \end{tabular}
  \end{center}
  \end{minipage}
    }
    \vspace{5pt}
  \scriptsize{%(ii)
    \begin{minipage}{0.49\textwidth}
      \begin{center}
        \begin{tabular}{c|ccc}
      \hline
    $h$ & $\norm{u-u_h}_{1, \Omega}$ & $\norm{\ud-\udh}_{1, \Lambda}$ & $\norm{L-L_h}_{-1/2, \Lambda}$\\
      \hline
4.3E-1 & 3.1E0(--)    & 5.4E-1(--)   & 4.4E-2(--)   \\
2.2E-1 & 1.7E0(0.87)  & 2.6E-1(1.06) & 1.1E-2(2.01) \\
1.1E-1 & 8.6E-1(0.96) & 1.3E-1(1.02) & 2.7E-3(2.01) \\
5.4E-2 & 4.4E-1(0.99) & 6.3E-2(1.00) & 6.7E-4(2.01) \\
2.7E-2 & 2.2E-1(1.00) & 3.1E-2(1.00) & 1.7E-4(2.01) \\
1.4E-2 & 1.1E-1(1.00) & 1.6E-2(1.00) & 4.1E-5(2.01) \\
\hline
  \end{tabular}
  \end{center}
  \end{minipage}
  }
  \caption{Error convergence of \eqref{eq:problem1_simple} and \eqref{eq:problem2_simple}
    on a benchmark problem \eqref{benchmark}. Continuous linear Lagrange
    elements are used.
  }
  \label{tab:error_conform}
\end{table}

In Table \ref{tab:error_conform} one can observe that the two formulations
yield practically identical approximations of $u$ and $\ud$. However, the solution
cost of the two approaches differs. In Table \ref{tab:cost} we summarize the
size of the linear systems solved at each level of refinement and the time
for the iterative solver to converge. Let us first note that the proposed
preconditioners seem robust with respect to discretization parameter as
the iteration counts are clearly bounded. We then see that the solution
time for \eqref{eq:problem1_simple} is about 2 times longer compared to
\eqref{eq:problem2_simple}. This is in addition to the higher setup costs
of the preconditioner which in our implementation involve solving an eigenvalue
problem for the fractional Laplacian. Therefore it is advantageous to keep
the multiplier space as small as possible. We remark that the missing
results for \eqref{eq:problem1_simple} in Table \ref{tab:cost} and \ref{tab:error_conform}
are due to the memory limitations which we encounter when solving the eigenvalue problem
for the Laplacian, which for finest mesh involves cca 32 thousand eigenvalues.
%
\begin{table}
  \scriptsize{
  \begin{center}
    \begin{tabular}{c|cc|ccc|ccc}
      \hline
      $h$ & $\dim{V_h}$ & $\dim{V_{\odot, h}}$ & $\dim{Q^{\Gamma}_h}$ & $\#$ & $T\left[s\right]$ & $\dim{Q^{\Lambda}_h}$ & $\#$ & $T\left[s\right]$\\
      \hline
4.33E-01 &125    &5  &40    &27 &0.03  &5  &9  &0.01\\
2.17E-01 &729    &9  &144   &55 &0.10  &9  &19 &0.02\\
1.08E-01 &4913   &17 &544   &62 &0.25  &17 &36 &0.14\\
5.41E-02 &35937  &33 &2112  &64 &1.97  &33 &42 &1.08\\
2.71E-02 &274625 &65 &8320  &64 &18.01 &65 &36 &8.24\\
1.35E-02 &--     &-- &--    &-- &--    &129 &31 &61.37\\
\hline
    \end{tabular}
    \end{center}
    }
  \caption{Cost comparison of the two formulations. Number of MinRes iterations
    is denoted by $\#$. Time till convergence of the iterative solver (excluding the setup) is shown
    as $T$.
  }
\label{tab:cost}
\end{table}

\textbf{Some plots of the solutions}

%\eqref{benchm_sol3d}-\eqref{benchm_sol1d}

%% \begin{remark}
%% Let us notice that the 3D solution \eqref{benchm_sol3d} is such that $\avrc{u}=0$. Therefore in \eqref{benchmark} it is like we are solving two separated problems, one in $\Omega$ and the other on $\Lambda$.
%% \end{remark}
%% \begin{remark}
%% It would be interesting to make a comparison between the solution of the fully coupled 3D-3D problem \eqref{eq:dirneu} (also in the simplified case of type \eqref{eq:dirneu_simple}) and the solution of the reduced problems \eqref{eq:problem1} and \eqref{eq:problem2}. 
%% Therefore, we could set the values of the data of the problem such that the reduced formulation becomes non-trivial and fully coupled.
%% Then, we will solve both the original and reduced problem to observe the differences in the solutions and the values of the Lagrange multiplier.
%% \end{remark}

\input{unfitted}
%-----------------
\bibliographystyle{siamplain}
\bibliography{3d1d_coupled}
\end{document}
