% SIAM Article Template
\documentclass[r]{siamart171218}
% Packages and macros go here
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{array}
\usepackage{graphicx}
\usepackage{epsfig}
\usepackage{float}
\usepackage{fullpage}
\usepackage{color}
\usepackage{enumitem}  
\usepackage{epstopdf}
\usepackage{stmaryrd}
\usepackage{tikz, subfigure}
\usepackage{booktabs}  % for tables
\usepackage{capt-of}
\usepackage{multirow}
\usepackage[displaymath, mathlines]{lineno}


\newcommand{\miro}[1]{{\color{cyan}#1}}
% Title. If the supplement option is on, then "Supplementary Material"
% is automatically inserted before the title.
%\title{On the weak coupling of 3D and 1D second order elliptic problems}
\title{Coupling PDEs on 3D-1D domains with Lagrange multipliers}

% Authors: full names plus addresses.
\author{Miroslav Kuchta, Federica Laurino, Kent-Andre Mardal, Paolo Zunino,\thanks{Authors are listed in alphabetical order}}

\begin{document}
\linenumbers

\maketitle

% REQUIRED
\begin{abstract}
Manuscript in preparation, to be kept confidential.
\end{abstract}

% REQUIRED
\begin{keywords}
elliptic problems, high dimensionality gap, essential coupling conditions, Lagrange multipliers
\end{keywords}

% REQUIRED
\begin{AMS}
n.a.
\end{AMS}

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 
% definitions here

\def\ud{u_{\odot}}
\def\vd{v_{\odot}}
\def\ld{\lambda_{\odot}}
\def\udh{u_{\odot h}}
\def\vdh{v_{\odot h}}
\def\ldh{\lambda_{\odot h}}
\def\md{\mu_{\odot}}
\def\lld{l_{\odot}}
\def\uf{u_{\ominus}}
\def\up{u_{\oplus}}
\def\eps{\epsilon}
\def\nn{\boldsymbol n}
\def\rr{\boldsymbol r}
\def\RR{\boldsymbol R}
\def\kk{\boldsymbol k}
\def\ss{\boldsymbol s}
\def\uu{\boldsymbol u}
\def\vv{\boldsymbol v}
\def\xx{\boldsymbol x}
\def\bu{\overline{u}}
\def\bv{\overline{v}}
\def\tu{\widetilde{u}}
\def\tv{\widetilde{v}}
\def\TT{\boldsymbol T}
\def\NN{\boldsymbol N}
\def\BB{\boldsymbol B}
\def\ttu{\widetilde{\widetilde{u}}}
\def\ttv{\widetilde{\widetilde{v}}}
\def\cv{\check{v}}
\def\mesh{{\cal T}^h}
\def\ball{{\cal B}}
\def\R{\mathbb{R}}
\def\D{\mathcal{D}}
\def\DD{\partial\mathcal{D}}
\def\trace{{\mathcal{T}_\Gamma}}
\def\mtrace{{\overline{\mathcal{T}}_\Lambda}}
\def\ext{\mathcal{E}_\Gamma}
\def\ide{\mathcal{I}}
\def\ii{\hat{\imath}}
\newcommand{\avrd}[1]{\overline{\overline{#1}}}
\newcommand{\avrc}[1]{\overline{#1}}
\newcommand{\refe}[1]{{#1}_{\mathrm{ref}}}
\newcommand{\norm}[1]{\lVert{#1}\rVert}

\newcommand{\vertiii}[1]{{\left\vert\kern-0.25ex\left\vert\kern-0.25ex\left\vert #1 
    \right\vert\kern-0.25ex\right\vert\kern-0.25ex\right\vert}}

\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}{Property}[section]
\theoremstyle{remark}
\newtheorem{remark}{Remark}[section]
 
% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\section{Introduction}\label{sec:intro}

We address the geometrical configuration of the problem for a 3D coupled problem formulation based on from Dirichlet-Neumann interface conditions. Then, we apply a model reduction technique that transforms the problem into 3D-1D coupled PDEs. We develop and analyze a robust definition of the coupling operators form a 3D domain, $\Omega$, to 1D manifold, $\Lambda$, and vice versa. This is a non trivial objective because the standard trace operator form a domain $\Omega$ to a subset $\Lambda$ is not well posed if $\Lambda$ is a manifold of co-dimension two of $\Omega$.

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\section{Problem setting}\label{sec:setting}

In this section we fist provide the main notation and definitions to set up the problem.
In particular, we address the geometry of the domain, which is equivalent to the one addressed in previous works of the authors \cite{laurino_m2an},
and we define the functional spaces and related operators necessary for a rigorous problem formulation and analysis.
Finally, the section ends with the formal derivation of the problem, 
based on averaging techniques applied to a fully three-dimensional model in the geometrical setting defined before.

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Geometry of the problem}
The domain is denoted as $\Omega$ is convex and composed by two parts, 
$\Omega_{\ominus}$ and $\Omega_{\oplus}:=\Omega\setminus\overline{\Omega}_{\ominus}$. 
Let $\Omega_{\ominus}$ be a \emph{generalized cylinder}, 
that is the swept volume of a two dimensional set moved along a curve in the three-dimensional space, see for example \cite{MR1940257}.
We also assume that $\Omega_{\ominus}$ crosses $\Omega$ from side to side, and we call $\Gamma$ the lateral surface of $\Omega_{\ominus}$, 
while the upper and lower faces of $\Omega_{\ominus}$ belong to $\partial\Omega$. 
Let $\boldsymbol \lambda(s) = [\xi(s), \tau(s), \zeta(s)], \ s\in(0,S)$ be a $\mathcal{C}^2$-regular curve in the three-dimensional space.
For simplicity, let us assume that $\|\boldsymbol \lambda^\prime(s)\|=1$ such that the arc-length and the coordinate $s$ coincide.
Let $\Lambda = \{\boldsymbol \lambda(s), \ s\in(0,S)\}$ be the centerline of the cylinder. 
According to the geometrical setting, we will denote with $v,\,v_\oplus,\,v_\ominus,\,\vd$,
functions defined on $\Omega,\,\Omega_{\oplus},\,\Omega_{\ominus},\,\Lambda$, respectively.
We refer to Figure \ref{fig1} for a sketch of the domains.

Let $\TT,\NN,\BB$ be the Frenet frame related to the curve.
Let $\mathcal{D}(s) = [x(r,t),y(r,t)]: (0,R(s))\times(0,T(s)) \rightarrow \R^2$ be a parametrization of the cross section.
Let us assume that $\mathcal{D}(s)$ is convex for any $s \in (0,S)$. The cross section can change size along $\Lambda$ but not shape.
Let us also parametrize the boundary of the cross section as $\partial\mathcal{D}(s) = [\partial x(r,t),\partial y(r,t)]: (0,R(s))\times(0,T(s)) \rightarrow \R^2$,
and let us assume that $\partial\mathcal{D}(s)$ is a piecewise $\mathcal{C}^2$-regular curve.
Then, the generalized cylinder $\Omega_{\ominus}$ can be defined as follows
\begin{equation*}
\Omega_{\ominus} = \{ \boldsymbol \lambda(s) + x(r,t) \NN(s) + y(r,t) \BB(s), \ r \in (0,R(s)),\ s \in (0,S), \ t \in (0,T(s))\}\,,
\end{equation*}
and the lateral boundary is
\begin{equation*}
\Gamma = \{ \boldsymbol \lambda(s) + \partial x(r,t) \NN(s) + \partial y(r,t) \BB(s), \ r \in (0,R(s)),\ s \in (0,S), \ t \in (0,T(s))\}\,.
\end{equation*}
Let $|\cdot|$ denote the Lebesgue measure of a set. If $|\mathcal{D}(0)|, \ |\mathcal{D}(S)| >0$ then $\Omega_{\ominus}$ has \emph{top} and \emph{bottom} boundaries,
which belong to $\partial\Omega$.

Thanks to the  geometrical structure of the generalized cylinder, 
for any sufficiently regular function $w$ we decompose integrals as follows
and we define the corresponding averages $\avrc{w},\,\avrd{w}$,
\begin{gather*}
\int_{\Omega_{\ominus}} w d\omega 
= \int_\Lambda \int_{\mathcal{D}(s)} w d\sigma ds
= \int_\Lambda |\mathcal{D}(s)|\avrd{w}(s) ds\,,
\ \textrm{where} \ \avrd{w}(s) = |\mathcal{D}(s)|^{-1} \int_{\mathcal{D}(s)} w d\sigma\,,
\\
\int_{\partial\Omega_{\ominus}} w d\sigma 
= \int_\Lambda \int_{\partial\mathcal{D}(s)} w d\gamma ds
= \int_\Lambda  |\partial \mathcal{D}(s)| \avrc{w}(s) ds\,,
\ \textrm{where} \ \avrc{w}(s) = |\partial\mathcal{D}(s)|^{-1} \int_{\partial\mathcal{D}(s)} w d\gamma\,,
\end{gather*}
being $d\omega, \ d\sigma, \ d\gamma$ the generic volume, surface and curvilinear Lebesgue measures.
Analogously, for functions defined on $\Lambda$ and $\Omega_\ominus$ respectively, 
we define as $d_s$ and $\partial_s$ the ordinary and partial derivative with respect to the arclength.

This work is based on the assumption that \emph{the transversal diameter of $\Omega_{\ominus}$ is small compared to the diameter of $\Omega$}. 
Let $d= \max_{s \in (0,S)} \mathrm{diam}(\D(s))$ be the largest diameter of the cross sections of $\Omega_{\ominus}$, that is the transversal diameter of $\Omega_{\ominus}$.
The central assumption of this work is that $d \ll \mathrm{diam}(\Omega)$.
Let us now scale the domains $\Omega$ and $\Omega_{\ominus}$.
Let $\chi_{\Omega}(\xx) = \xx / \mathrm{diam}(\Omega)$ be a scaling function and let be $\Omega_\chi = \chi_{\Omega}(\Omega), \ {\Omega_{\ominus}}_\chi =  \chi_{\Omega}(\Omega_{\ominus})$ be the scaled domains. The previous assumption implies that for the scaled domains $\epsilon = d_\chi = d/\mathrm{diam}(\Omega)$
is such that $0 < \epsilon \ll 1$. For simplicity of notation, and without loss of generality, form now on we will implicitly refer to the scaled domains dropping the subindex $\chi$.

\begin{figure}
\begin{center}
\includegraphics[width=0.5\textwidth]{3D-1D-simple.png}
\end{center}
\caption{Geometrical setting of the problem}
\label{fig1}
\end{figure}

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Functional setting and preliminary results}

Let $D$ be a generic regular bounded domain in $\R^3$. 
Let $X$ be a Hilbert space defined on $D$.
Let $(\cdot,\cdot)_X$ denote the inner product of $X$.
Let $(\cdot,\cdot)_L^2(D)$,  $(\cdot,\cdot)_D$ or simply $(\cdot,\cdot)$ be the $L^2(D)$ inner product on $D$.
For the domain $\Lambda$ we will use the following notation for the weighted inner product,
\begin{equation*}
(\ud,\vd)_{\Lambda,w} = \int_0^S w(s) \ud(s) \vd(s) ds\,.
\end{equation*}
Given an Hilbert space $X$ and its dual $X^*$, the duality pairing between the two is denoted as $\langle\cdot,\cdot\rangle$.
When needed, the integration weights will be also applied to the duality product.

We will use the standard notation $H^q(D)$ to denote the Sobolev space of functions on $D$ with all derivatives up to the order $q$ in $L^2(D)$.
The corresponding norm is $\|\cdot\|_{H^q(D)}$ and the seminorm is $\vert\cdot\vert_{H^q(D)}$.
The space $H^q_0(D)$ represents the closure in $H^q(D)$ of smooth functions with compact support in $D$.

Let $\Sigma$ be a Lipschitz co-dimension one subset of $D$. 
We denote with $\mathcal{T}: H^q(D) \rightarrow H^{q-\frac12}(\Sigma)$ the trace operator from $D$ to $\Sigma$.
For the purpose of this work we will extensively use traces on $\Gamma$ of functions defined on $\Omega$. Such operator will be denoted with $\trace$. 
The operator obtained form the combination of the average operator $\avrc{(\cdot)}$ with the trace on $\Gamma$ will be denoted with $\mtrace = \avrc{(\cdot)} \circ \trace$,
as it maps functions on $\Omega$ to functions on $\Lambda$.

Fractional Sobolev spaces arising from the application of the trace operator are particularly important in this work.
For example the trace space on $\Gamma$ of $H^1_0(\Omega)$ will be be extensively used for this study.
We denote this space as $H^{\frac12}_{00}(\Gamma) = \trace H^1_0(\Omega)$.
It can be interpreted as the subspace of $H^{\frac12}(\Gamma)$ of functions with continuous extension by zero outside $\Gamma$.
We remark that $(H^{\frac12}_{00}(D))^* = H^{-\frac12}(D)$ with $D=\Gamma,\Lambda$.
We will see later that functions belonging to $H^{\frac12}_{00}(\Lambda)$ are generated from the application of $\mtrace$ to $H^1_0(\Omega)$.

In what follows we will also use the uniform extension to $\Omega_{\ominus}$ of functions defined on $\Lambda$.
Namely, given $\vd(s)$ we define $\mathcal{E}_{\Omega_{\ominus}}$ as $\mathcal{E}_{\Omega_{\ominus}}\vd(s,r,t)=\vd(s)$.
Then, taking the trace on $\Gamma$ of the extended function we obtain an extension map from $\Lambda$ to $\Gamma$, denoted as $\ext$.
We observe that $\ext: H^\frac12_0(\Lambda) \rightarrow H^\frac12_{00}(\Gamma)$ satisfies the following property
\begin{equation}\label{eq:ext}
\langle \mtrace u, \vd \rangle_{\Lambda, |\DD|} 
= \int _{\Lambda} |\DD| \left( \frac{1}{|\DD|} \int_{\DD} \trace u \, d\gamma \right) \vd \, ds 
= \langle \trace u, \ext \vd\rangle_{\Gamma}\,,
\end{equation} 
which shows that the average and the uniform extension operator commute.

From the theory of interpolation of Sobolev spaces we define the fractional norms $\|\cdot \|_{H^{\frac 12}_{00}(\Gamma)}$ and $\|\cdot \|_{H^{\frac 12}_{00}(\Lambda)}$ as functions of the eigenvalues and eigenfunctions of the Laplacian on $\Gamma$ and $\Lambda$ respectively, see for example \cite{MR0350177,MR2328004}. 
We denote as $\phi _{ij}$ and $\rho _{ij}$, for $i=1,2,\dots$, $j=0,1,\dots$, the eigenfunctions and the eigenvalues of the Laplacian on $\Gamma$ with homogeneous Dirichlet condition at the boundary. Then, the norms of $H^{\frac 12}_{00}(\Gamma),\,H^{\frac 12}_{00}(\Lambda)$ and the corresponding dual norms are defined as
\begin{equation}\label{eq:fracnorm_gamma}
\|u\|_{H^{\frac 12}_{00}(\Gamma)}=\left(\sum_{i=1}^{\infty}\sum_{j=0}^{\infty} \left( 1+ \rho_{ij}\right)^{\frac 12}|a_{ij}|^2\right)^{\frac 12}
\ \text{with} \ a_{ij}=\left( u,\phi _{ij} \right)_{\Gamma};
\quad
\| v \|_{H^{-\frac 12}(\Gamma)} = \sup_{u\in H^{\frac 12}_{00}(\Gamma)}\frac{\langle u, v \rangle_\Gamma}{\|u\|_{H^{\frac 12}_{00}(\Gamma)}}\,.
\end{equation}
Similarly, denoting with $\phi _i$ and $\rho _i$ the eigenfunctions and the eigenvalues of the Laplacian on $\Lambda$ with homogenous Dirichlet boundary conditions, if $u \in H^{\frac 12}(\Lambda)$ we have
\begin{equation}\label{eq:fracnorm_lambda}
\|u\|_{H^{\frac 12}_{00}(\Lambda)}=\left(\sum_{i=1}^{\infty} \left( 1+ \rho_{i}\right)^{\frac 12}|a_i|^2\right)^{\frac 12}
\ \text{with} \ a_i=\left(u, \phi _i \right)_{\Lambda};
\quad
\| v \|_{H^{-\frac 12}(\Lambda)} = \sup_{u\in H^{\frac 12}_{00}(\Lambda)}\frac{\langle u, v \rangle_\Lambda}{\|u\|_{H^{\frac 12}_{00}(\Lambda)}}\,.
\end{equation}
We define the equivalent weighted norm in $H^{\frac 12}_{00}(\Lambda)$ in the same way,
\begin{equation}\label{eq:weightfracnorm}
\|u\|_{H^{\frac 12}_{00}(\Lambda), |\DD|}=\left(\sum_{i=1}^{\infty} \left( 1+ \rho_{i}\right)^{\frac 12}|a_i|^2\right)^{\frac 12},
\ \text{with} a_i=\left(u, \phi _i \right)_{\Lambda, |\DD|};
\quad
\| v \|_{H^{-\frac 12}(\Lambda)} = \sup_{u\in H^{\frac 12}_{00}(\Lambda)}\frac{\langle u, v \rangle_{\Lambda, |\DD|}}{\|u\|_{H^{\frac 12}_{00}(\Lambda), |\DD|}}\,.
\end{equation}

We conclude this section with the analysis of a fundamental property for the problem formulation that we will address.
It consists in the characterization of the regularity of the operator $\mtrace$.
More precisely we aim to show that $\mtrace: H^1_0(\Omega) \rightarrow H^\frac12_{00}(\Lambda)$.
This is a consequence of the following lemma.

\input{preliminary_results.tex}

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Problem formulation}
We consider the problem arising from \emph{Dirichlet-Neumann} conditions. Find $\up,\uf$ s.t.:
\begin{subequations}\label{eq:dirneu}
\begin{align}
\label{eq:dirneu1}
- \Delta \up  + \up &= f  && \text{ in } \Omega_{\oplus},\\
\label{eq:dirneu2}
- \Delta \uf  + \uf &= g  && \text{ in } \Omega_\ominus,\\
\label{eq:dirneu3}
-\nabla \uf \cdot \nn_{\ominus} &= -\nabla \up \cdot \nn_{\ominus}  && \text{ on } \Gamma,\\
\label{eq:dirneu4}
\uf &= \up && \text{ on }  \Gamma,\\
\label{eq:dirneu5}
\up &= 0 && \text{ on } \partial \Omega\,.
\end{align}
\end{subequations}

We observe that the coupling constraints defined on $\Gamma$ involve \emph{essential}-type conditions.
To address such conditions at the level of the variational formulation, we adopt the method of Lagrange multipliers,
which has been widely used for this purpose since the origin of the finite element method, \cite{MR359352}.
We remark that this case is substantially different from the one previously addressed in \cite{laurino_m2an}.

The variational formulation of problem \eqref{eq:dirneu}
is to find $\up \in H^1_{\partial\Omega}(\Omega_\oplus), \ \uf \in H^1_{\partial\Omega_\ominus\setminus\Gamma}(\Omega_\ominus), \ \lambda \in H^{-\frac12}(\partial\Omega_\ominus)$ s.t.
\begin{subequations}\label{eq:weak_dirneu}
\begin{align}
&(u_\oplus,v_\oplus)_{H^1(\Omega_\oplus)} + (u_\ominus,v_\ominus)_{H^1(\Omega_\ominus)} 
+ \langle  v_\oplus - v_\ominus, \lambda \rangle_{\Gamma} 
\\
\nonumber
&\qquad\qquad = (f,v_\oplus)_{L^2(\Omega_\oplus)} + (g,v_\ominus)_{L^2(\Omega_\ominus)}
\quad \forall v_\oplus \in H^1_{\partial\Omega}(\Omega_\oplus), \ v_\ominus \in H^1_{\partial\Omega_\ominus\setminus\Gamma}(\Omega_\ominus)
\\
& \langle u_\oplus - u_\ominus, \mu \rangle_{\Gamma} = 0
\quad \forall  \mu \in H^{-\frac12}(\Gamma)\,,
\end{align}
\end{subequations}
%where $\langle v, \mu \rangle_{H^{-\frac12}(\Gamma)}$ denotes the duality pairing between 
%$ \mu \in H^{-\frac12}(\Gamma)$ and $v \in H^{\frac12}(\Gamma)$.
In this case, $\lambda$ is the Lagrange multiplier and it is equivalent to $\nabla \uf \cdot \nn_\ominus$.

The objective of this work is to derive and analyze a simplified version of problem \eqref{eq:weak_dirneu}, where the domain $\Omega_\ominus$ shrinks to its centerline $\Lambda$ and the corresponding partial differential equation is averaged on the cylinder cross section, namely $\mathcal{D}$. This new problem setting will be called the \emph{reduced} problem. Form the mathematical standpoint it is more challenging than \eqref{eq:weak_dirneu}, because it involves the coupling of 3D/1D elliptic problems.
We end up with two different formulations of a reduced problem for the unknown $u$ defined on the entire 3D domain $\Omega$, 
coupled with the unknown $\ud$, defined on the 1D manifold $\Lambda$ and a Lagrange multiplier defined either on $\Gamma$ (problem 1) or on $\Lambda$ (problem 2). 
The scope of this work is to analyze and compare the two alternatives,
with the aim to determine which is the most suitable to set up a computational model for 3D-1D PDEs coupled with Dirichlet-Neumann constraint.

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsection{Topological model reduction}
\subsubsection*{Model reduction of the problem on $\Omega_{\ominus}$}

We apply the averaging technique to equation \eqref{eq:dirneu2}. In particular, we consider an arbitrary portion $\mathcal{P}$ of the cylinder $\Omega_\ominus$, with lateral surface $\Gamma _{\mathcal{P}}$ and bounded by two perpendicular sections to $\Lambda$, namely $\mathcal{D}(s_1), \ \mathcal{D}(s_2)$ with $s_1<s_2$. We have,
\begin{multline*}
\int_{\mathcal{P}} -\Delta \uf + \uf d\omega =
-\int_{\partial \mathcal{P}} \nabla \uf \cdot \nn_{\ominus} \, d\sigma  + \int_{\mathcal{P}}\uf d\omega=
\\
 \int_{\mathcal{D}(s_1)} \partial_s \uf d\sigma -  \int_{\mathcal{D}(s_2)} \partial_s \uf d\sigma -  \int_{\Gamma_{\mathcal{P}}} \nabla \uf \cdot \nn_{\ominus} d\sigma +\int_{\mathcal{P}}\uf d\omega
\end{multline*}
By the fundamental theorem of integral calculus combined with the Reynolds transport Theorem, 
being $\nu$ the normal deformation of the boundary along $(0,S)$, we have,
\begin{equation*}
\begin{split}
\int_{\mathcal{D}(s_1)} \partial_s \uf d\sigma -  \int_{\mathcal{D}(s_2)} \partial_s \uf d\sigma 
&= -\int_{s_1}^{s_2} d_s \int_{\mathcal{D}(s)}  \partial_s \uf d\sigma ds
\\
&= -\int_{s_1}^{s_2} d_{ss}^2 \int_{\D(s)} u_{\ominus} \, d\sigma \, ds +  \int_{s_1}^{s_2} d_s \left( \int_{\DD(s)} \nu u_{\ominus} \, d\gamma \right) ds\,,
\end{split}
\end{equation*}
and assuming that $\D(s)$  can not change shape, we have
\begin{equation*}
\begin{split}
-\int_{s_1}^{s_2} d_{ss}^2 \int_{\D(s)} u_{\ominus} \, d\sigma \, ds + \int_{s_1}^{s_2} d_s \left( \int_{\DD(s)} \nu u_{\ominus} \, d\gamma \right)\, ds
&=-\int_{s_1}^{s_2} \left[d_{ss}^2 (|\D(s)|\avrd{u}_{\ominus}) -  d_s(  \nu |\DD(s)| \avrc{u}_{\ominus} ) \right] \, ds
\\
&=-\int_{s_1}^{s_2} \left[d_{ss}^2 (|\D(s)|\avrd{u}_{\ominus}) -  d_s\left(d_s(|\D(s)|) \avrc{u}_{\ominus} \right) \right] \, ds.
\end{split}
\end{equation*}
Moreover, we have
\begin{equation*}
\int_{\Gamma_{\mathcal{P}}} \nabla \uf \cdot \nn_{\ominus} d\sigma =  \int_{\Gamma_{\mathcal{P}}} \lambda \, d\sigma
=  \int_{s_1}^{s_2} \int_{\partial\mathcal{D}(s)} \lambda d\gamma \, ds 
= \int_{s_1}^{s_2} |\DD| \avrc{\lambda} \,ds\,.
\end{equation*}
From the combination of all the above terms with the right hand side, we obtain that the solution $\uf$ of \eqref{eq:dirneu2} satisfies,
\begin{equation*}
\int_{s_1}^{s_2} \left[ 
-d_{ss}^2 (|\D(s)|\avrd{u}_{\ominus}) +  d_s\left(d_s(|\D(s)|) \avrc{u}_{\ominus}\right) + |\D(s)|\avrd{u}_{\ominus} 
- |\partial\mathcal{D}(s)| \avrc{\lambda} 
\right] \, ds = \int_{s_1}^{s_2} |\mathcal{D}(s)| \avrd{g}\, ds \,.
\end{equation*}
Since the choice of the points $s_1,s_2$ is arbitrary, we conclude that the following equation holds true,
\begin{equation}\label{eq:averaged_f}
-d_{ss}^2 (|\D(s)|\avrd{u}_{\ominus}) +  d_s\left(d_s(|\D(s)|) \avrc{u}_{\ominus}\right) + |\D(s)|\avrd{u}_{\ominus} 
- |\partial\mathcal{D}(s)| \avrc{\lambda}
= |\mathcal{D}(s)| \avrd{g} \quad \text{on} \ \Lambda\,,
\end{equation}
which is complemented by the following conditions at the boundary of $\Lambda$,
\begin{equation}\label{eq:averaged_f_boundary}
|\D(s)| d_s \avrd{u}_{\ominus} = 0, \quad d_s |\D(s)| = 0, \quad \text{on} \quad s=0,S.
\end{equation}
Then, we consider variational formulation of the averaged equation \eqref{eq:averaged_f}.
After multiplication by a test function $\vd \in H^1(\Lambda)$, integration on $\Lambda$ and suitable application of integration by parts, we obtain,
\begin{multline*}
\int_\Lambda d_s (|\D(s)| \avrd{u}_{\ominus} ) d_s \vd \, ds - d_s (|\D(s)| \avrd{u}_{\ominus} ) \vd |_{s=0}^{s=S}
- \int_\Lambda (d_s |\D(s)|)\avrc{u}_{\ominus} d_s \vd \, ds + (d_s |\D(s)|) \avrc{u}_{\ominus} \vd |_{s=0}^{s=S}
\\
+\int_\Lambda |\D(s)| \avrd{u}_\ominus \vd - \int_\Lambda |\DD(s)| \avrc{\lambda} \vd \, ds
= \int_\Lambda |\D(s)| \avrd{g} V\, ds\,.
\end{multline*}
Using boundary conditions, 
the identity $d_s (|\D(s)| \avrd{u}_{\ominus} ) = |\D(s)| d_s \avrd{u}_{\ominus} + d_s (|\D(s)|) \avrd{u}_{\ominus}$
and reminding that $d_s |\D(s)|)/|\DD(s)| = \nu$,
we obtain,
\begin{equation}\label{eq:averaged_f_weak}
(d_s \avrd{u}_{\ominus}, d_s \vd )_{\Lambda,|\D|} 
+ ( \nu (\avrd{u}_{\ominus} - \avrc{u}_{\ominus}), d_s \vd)_{\Lambda,|\DD|} +(\avrd{u}_\ominus, \vd)_{\Lambda, |\D|}
- (\avrc{\lambda},\vd)_{\Lambda,|\DD|}
= (\avrd{g},V)_{\Lambda,|\D|}\,.
\end{equation}
Let us now formulate the modelling assumption that allows us to reduce equation \eqref{eq:averaged_f_weak} to a solvable one-dimensional (1D) model.
More precisely, we assume that the function $\uf$ has a \emph{uniform profile} on each cross section $\mathcal{D}(s)$, namely $\uf(r,s,t) = \ud(s)$.
Therefore, observing that $\ud=\avrc{u}_{\ominus}=\avrd{u}_{\ominus}$, problem \eqref{eq:averaged_f_weak} turns out to find $\ud \in H^1(\Lambda)$ such that
\begin{equation}\label{eq:1Ddirneu_weak}
 (d_s \ud, d_s \vd)_{\Lambda,|\mathcal{D}|} 
+(\ud, \vd)_{\Lambda, |\D|}
-(\avrc{\lambda},\vd)_{\Lambda, |\DD|}
=  (\avrd{g},\vd)_{\Lambda, |\mathcal{D}|}
\quad \forall \vd \in H^1(\Lambda)\,.
\end{equation}

% >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
\subsubsection*{Topological model reduction of the problem on $\Omega_{\oplus}$}
We focus here on the subproblem of \eqref{eq:dirneu1} related to $\Omega_{\oplus}$.
We multiply both sides of \eqref{eq:dirneu1} by a test function $v\in H^1_0(\Omega)$ and integrate on $\Omega_\oplus$. Integrating by parts and using boundary and interface conditions, we obtain
\begin{equation*}
\begin{split}
\int_{\Omega _{\oplus}}fv\,d\omega&=
\int _{\Omega _{\oplus}}\nabla \up \cdot\nabla v\,d\omega -\int _{\partial \Omega _{\oplus}}\nabla \up \cdot \nn_{\oplus} v\,d\sigma + \int_{\Omega_{\oplus}} \up v
\\
&=\int _{\Omega _{\oplus}}\nabla \up \cdot\nabla v\,d\Omega -\int_{\Gamma} \nabla \up \cdot \nn_{\oplus} v + \int_{\Omega_{\oplus}} \up v
\\
&=\int _{\Omega _{\oplus}}\nabla \up \cdot\nabla v\,d\Omega +\int_{\Gamma} \lambda v + \int_{\Omega_{\oplus}} \up v.
\end{split}
\end{equation*} 
Then, we make the following modelling assumption:
we identify the domain $\Omega_{\oplus}$ with the entire $\Omega$, 
and we correspondingly omit the subscript $\oplus$ to the functions defined on $\Omega_{\oplus}$,
namely
\begin{equation*}
\int_{\Omega_{\oplus}} u_\oplus\, d\omega \simeq \int_{\Omega} u\, d\omega\,.
\end{equation*}
Therefore, we obtain 
\begin{equation*}
(\nabla u ,\nabla v)_{\Omega} +(u,v)_{\Omega}+(\lambda, v)_{\Gamma}  =(f,v)_{\Omega}
\end{equation*}
and combining with \eqref{eq:1Ddirneu_weak} we obtain the first formulation of the reduced problem.

\subsubsection*{Problem 1 (3D-2D-1D)}
Find $u \in H^1_0(\Omega), \ \lambda \in H^{-\frac12}(\Gamma ),\ \ud \in H^1_0(\Lambda)$, such that
\begin{subequations}\label{eq:problem1}
\begin{align}
&(u,v)_{H^1(\Omega)} + (\ud,\vd)_{H^1(\Lambda),|\D|} 
+ \langle \trace v  - \ext \vd, \lambda \rangle_\Gamma &&
\\
\nonumber
&\qquad= (f,v)_{L^2(\Omega)} +  (\avrd{g},\vd)_{L^2(\Lambda),|\D|}
\quad &&\forall v \in H^1_0(\Omega), \ \vd \in H^1(\Lambda)\,,
\\
& \langle \trace u - \ext \ud , \mu \rangle_\Gamma = 0
\quad && \forall \mu \in H^{-\frac12}(\Gamma)\,.
\end{align}
\end{subequations}
This coupled problem is classifies as 3D-2D-1D because the unknowns $u,\lambda,\ud$ belong to 
$\Omega \subset \R^3,\, \Gamma \subset \R^2,\, \Lambda \subset \R$, respectively.
Then, we apply a topological model reduction of the interface conditions, namely we go from a 3D-2D-1D formulation
involving sub-problems on $\Omega$ and $\Lambda$ and coupling operators defined on $\Gamma$
to a 3D-1D-1D formulation where the coupling terms are set on $\Lambda$. 
To this purpose, let us write the Lagrange multiplier and the test functions on every cross section $\partial\mathcal{D}(s)$ as their average plus some fluctuation,
\begin{equation*}
\lambda=\avrc{\lambda}+\tilde{\lambda}, \qquad v=\avrc{v}+\tilde{v},
\quad \text{on} \ \partial\mathcal{D}(s)\,,
\end{equation*}
where $\avrc{\tilde{\lambda}}=\avrc{\tilde{v}}=0$. 
Therefore, the coupling term on $\Gamma$ can be decomposed as,
\begin{equation*}
\int_{\Gamma}\lambda v\, d\sigma
=\int _{\Lambda}  \int_{\partial\mathcal{D}(s)} (\avrc{\lambda}+\tilde{\lambda})(\avrc{v}+\tilde{v})d\gamma ds
= \int_{\Lambda}|\partial\mathcal{D}(s)| \avrc{\lambda}\avrc{v}\,ds+\int_{\Lambda}  \int_{\partial\mathcal{D}(s)} \tilde{\lambda}\tilde{v}d\gamma ds\,.
\end{equation*}

Thanks to the additional assumption that the product of fluctuations is small, namely
\begin{equation*}
\int_{\partial\mathcal{D}(s)} \tilde{\lambda}\tilde{v} d\gamma \simeq 0\,
\end{equation*}
the term $\left(\trace v, \lambda \right)_{\Gamma}$ becomes $\left( \mtrace v, \avrc{\lambda} \right)_{\Lambda, |\DD|}$, where $\mtrace$ denotes the composition of operators $\trace \circ \avrc{(\cdot)}$.  Combined with \eqref{eq:1Ddirneu_weak}, this leads to the second formulation of the reduced problem.

\subsubsection*{Problem 2 (3D-1D-1D)}
Find $u \in H^1_0(\Omega),\ \ud \in H^1_0(\Lambda), \ \ld \in H^{-\frac12}(\Lambda)$, such that
\begin{subequations}\label{eq:problem2}
\begin{align}
&(u,v)_{H^1(\Omega)} + (\ud,\vd)_{H^1(\Lambda),|\D|} 
+  \langle \mtrace v - \vd, \ld \rangle_{\Lambda, |\DD|} &&
\\
\nonumber
&\qquad\qquad= (f,v)_{L^2(\Omega)} +  (\avrd{g},V)_{L^2(\Lambda),|\D|}
\quad && \forall v \in H^1_0(\Omega), \ \vd \in H^1_0(\Lambda)\,,
\\
& \langle \mtrace u -   \ud, \md \rangle_{\Lambda,|\DD|} = 0
\quad &&\forall \md \in H^{-\frac12}(\Lambda)\,,
\end{align}
\end{subequations}
We notice that all the integrals of the reduced problem are well defined because 
$\mtrace: H^1_0(\Omega) \rightarrow H^\frac12_{00}(\Lambda)$ as shown in Corollary \ref{corollary:H12norm}.

The well-posedness of $\eqref{eq:problem1}$ and $\eqref{eq:problem2}$ 
can be studied in the framework of the classical theory of saddle point problems as shown in the following.

%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
%Analysis of the continuous problem 
\input{infsup_continuous}

%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
%Analysis of the discrete problem in the case in which the LM lives on the coarser mesh w.r.t the trace mesh deriving from the 3D mesh

%\input{infsup_discrete_coarserLM}

%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
%Analysis of the discrete problem in the case in which the LM lives on the the trace mesh deriving from the 3D mesh (conforming to the interface cylinder \Gamma)

\input{infsup_discrete_conformingLM}

%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
%Analysis of the discrete problem in the case in which we have a non conforming 3D mesh (just in the case of formulation 2 3D-1D-1D)

\input{unfitted_prob2}

%>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

\input{benchmark}
%-----------------
\bibliographystyle{siamplain}
\bibliography{3d1d_coupled}

\appendix
\input{appendix}
\end{document}
