\def\patch{\omega _j}
\subsection{$\mathcal{T}^{\Omega}_h$ non conforming to $\Gamma$}\label{sec:unfit2}
We analyze now the case in which the elements of the 3D mesh $\mathcal{T}^{\Omega}_h$ cut the interface $\Gamma$. It is easy to understand that the formulation of Problem 2 is more suitable. 
%{\color{red} Add more details, we can refer also to cutFEM (Burman, Massing etc.) explaining the limitation of that approach (network case for example).}\\
Therefore we focus on the analysis of Problem 2.

\subsubsection{Problem 2} We consider for the solutions $u_h$ and ${\ud}_h$ the spaces $X_{h,0}^1(\Omega)$ and $X_{h,0}^1(\Lambda)$, see the previous subsection for the definition. Notice that in this case we suppose that the mesh sizes of the 3D mesh $\mathcal{T}^{\Omega}_h$ and the 1D mesh $\mathcal{T}^{\Lambda}_{h'}$ are different, in particular we suppose the 1D mesh is finer. Concerning the multiplier space, let $\mathcal{G}_h = \{K \in \mathcal{T}^{\Omega}_h: \, K\cap \Lambda \neq \emptyset\}$, namely the set of the 3D elements which intersect $\Lambda$, and let us define $Q_h=\{{\ld}_h : {\ld}_h \in P^0(K) \, \forall K \in \mathcal{G}_h\}$. We notice that we are extending the multiplier to the 3D elements: equivalenty we could have defined $\lambda_h$ as a piecewise constant function on $K\cap \Lambda$ for any $K \in \mathcal{G}_h$, but we use this trick so that we do not need to consider the 1D mesh given by the intersection of the elements of $\mathcal{G}_h$ with $\Lambda$. With this choice the problem is not inf-sup stable, therefore the idea is to add a stabilization term $s({\ld}_h, {\md}_h)$ to \eqref{eq:prob2_discrete} following the approach introduced in \cite{burman2014}. In particular, we build a new multiplier space $L_h$ for which the discrete inf-sup condition is fulfilled and we build a projection operator $\pi_L: Q_h \rightarrow L_h$ such that for any $[v, \vd] \in X $
\begin{equation}\label{condition_pi_L}
b([v, \vd], {\ld}_h - \pi_L {\ld}_h) \lesssim \vertiii{[v,\vd]}\|{\ld}_h - \pi_L {\ld}_h\|_{L_h},
\end{equation}
where for $X$ and $\vertiii{[\cdot, \cdot]}$ we use the definitions of section $3.2$ and $\|\cdot \|_{L_h}$ denotes a suitable discrete norm on $L_h$. Then, the following lemma holds
\begin{lemma}\cite[Lemma2.1]{burman2014}
Under the previous assumption, $\forall {\ld}_h \in Q_h$,
\begin{equation*}
\|{\ld}_h\|_{H^{-\frac 12}(\Lambda)} \lesssim \sup_{\substack{v_h \in X_{h,0}^1(\Omega)\\ {\vd}_h \in X_{h,0}^1(\Lambda)}} \frac{b([v_h, {\vd}_h], {\ld}_h)}{\vertiii{[v_h, {\vd}_h]}} + \|{\ld}_h - \pi_L {\ld}_h\|_{L_h}
\end{equation*}
\end{lemma}
 Based on this projection operator, we build the stabilization term $s({\ld}_h, {\md}_h)$ satisfying
 \begin{equation*}
 \|{\ld}_h- \pi_L {\ld}_h\|_{L_h} \lesssim s({\ld}_h, {\ld}_h)
\end{equation*}  and prove that $\forall [u_h, {\ud}_h]$, there exists $\xi_h([u_h, {\ud}_h]) \in Q_h$ s.t.
\begin{equation}\label{stab_coercivity}
a([u_h, {\ud}_h],[u_h, {\ud}_h] ) + b([u_h, {\ud}_h], \xi_h([u_h, {\ud}_h])) \geq \alpha_\xi \vertiii{[u_h, {\ud}_h]}_{X_{h,0}^1(\Omega)\times X_{h,0}^1(\Lambda) },
\end{equation}
\begin{equation}\label{stab_stability}
(s(\xi_{h}, \xi_{h}))^{\frac 12} \leq c_s \vertiii{[u_h, {\ud}_h]}_{X_{h,0}^1(\Omega)\times X_{h,0}^1(\Lambda) },
\end{equation}
being $\vertiii{[\cdot \, ,\, \cdot] }_{X_{h,0}^1(\Omega)\times X_{h,0}^1(\Lambda) }$ a suitable discrete norm. Then, the stabilized problem 
\begin{multline}\label{eq:prob2_stabilized}
a([u_h, {\ud}_h], [v_h, {\vd}_h]) +
b([v_h, {\vd}_h], {\ld}_h) +\\
b([u_h, {\ud}_h], {\md}_h) 
- s({\ld}_h, {\md}_h) = c(v_h) + d({\md}_h)\\
  \qquad \forall [v_h, {\vd}_h] \in {X_{h,0}^1(\Omega)\times X_{h,0}^1(\Lambda), \, \forall \md}_h \in Q_h
\end{multline}
is well posed thanks to the following lemma.
\begin{lemma}\cite[Lemma2.3]{burman2014}
Under the previous assumptions, system \eqref{eq:prob2_stabilized} admits a unique solution $\{[u_h, {\ud}_h], {\ld}_h \}$.
\end{lemma}

We recall that in the case of Problem 2, 
\begin{equation*}
b([u_h, {\ud}_h], {\ld}_h) = \left(\mtrace u_h - {\ud}_h, {\ld}_h\right)_{\Lambda,|\DD|}.
\end{equation*}
The construction of the inf-sup stable space $L_h$ is based on macro elements of diameter $H$, where $H$ is sufficiently larger than $h$. In particular, we assume that there exists positive constants $c_h$ and $c_H$ such that $c_h h\leq H \leq c_H^{-1}h$, with $c_h$ is sufficiently large. The space is constructed assembling the 3D elements of $\mathcal{G}_h$ into macro patches $ \patch $ such that $H \leq |\patch\cap \Lambda|\leq cH$. Namely, $\patch=\cup _{i=0}^{M_j} K_i$, where $K_i \in \mathcal{G}_h$ and $M_j$ is uniformly bounded in $j$ by some $M\in \mathbb{N}$ and $H=\min_{j}|\patch\cap \Lambda|$. We assume that the interiors of the patches $\patch$ are  disjoint. We define 
\begin{equation*}
L_h=\left\{{\lld }_h: \, {\lld }_h\in P^0(\patch)\, \forall j \right\}.
\end{equation*}

%figure extended patch
\begin{figure}\label{fig:patch}
\center
\input{./graphics/ext_patch}
\caption{Extended patches $\omega_j$.}
\end{figure}

Moreover, we associate to each patch $\patch$ a shape-regular extended patch, still denoted by $\omega_j$ for notational simplicity, which is built adding to $\patch$ a sufficient number of elements of $\mathcal{T}_h^{\Omega}$ and we assume that the interiors of the new extended patches $\omega _j$ are still disjoint (see Figure \ref{fig:patch}). Here we are using the classical definition of shape-regularity, see for example \cite{MR2050138}, namely there exist a constant $C>0$ such that for any $\omega_j$, $\frac{\tilde{\rho}_j}{\bar{\rho}_j}\leq C$, being $\tilde{\rho}_j$ the diameter of $\omega_j$ and $\bar{\rho}_j$ the diameter of the largest ball that can be inscribed in $\omega_j$. The extended patches $\omega _j$ are built such that they fulfill the conditions meas$(\patch)=\mathcal{O}(H^3)$ and diam$(\Gamma_{\patch\cap \Lambda}\cap \omega_j)=O(H)$, where $\Gamma_{\patch\cap \Lambda}$ is the portion of $\Gamma$ with centerline $\patch\cap \Lambda$. See Figure \ref{fig:gamma_generated} for a representation in the simple case in which $\omega _j$ is composed just by one tetrahedron. The latter assumption is required to ensure that the intersection of $\Gamma_{\patch\cap \Lambda}$ and $\omega_j$ is not too small and it will be needed later on to prove the inf-sup stability of the space $L_h$ in Lemma \ref{lemma:Lh_infsup}. We equipe the space $L_h$ with the discrete norm 
\begin{equation*}
\|\lld \|_{L_h} = \|\lld \|_{-\frac 12, h, \Lambda} = \|h^{\frac 12} \  \lld \|_{L^2(\Lambda)}.
\end{equation*}
As shown in \cite[Section III]{burman2014}, we can always choose $\pi_L$ as the $L_2$ orthogonal projection operator from $\Lambda_h$ to $L_h$ in order to satisfy \eqref{condition_pi_L} and then in practice replace it with any interpolation $\tilde{\pi}_L$ of $\Lambda_h$ in $L_h$. In particular, we define $\forall \lambda_h \in \Lambda_h$,
\begin{equation*}
\tilde{\pi}_L {\ld}_{ _{|\patch}} = N_j^{-1} \sum_{\substack{i: \ K_i \in \mathcal{G}_h, \  K_i \cap \omega_j \neq \emptyset}} {\ld}_{|K_i} \qquad \text{for all $\omega_j$,} 
\end{equation*}
being $N_j$ the cardinality of the set $\{i: \ K_i \in \mathcal{G}_h, \  K_i \cap \omega_j \neq \emptyset\}$. These choice leads to the following stabilization 
\begin{equation}\label{eq:stab}
s({\ld}_h, {\md}_h)= \sum _{K\in \mathcal{G}_{h}} \int_{\partial K\setminus \partial \mathcal{G}_{h}} h \llbracket {\ld}_h \rrbracket \llbracket {\md}_h \rrbracket,
\end{equation}
being $\llbracket {\ld}_h \rrbracket$ the jump of ${\ld}_h$ across the internal faces of $\mathcal{G}_h$.

\begin{figure}\label{fig:gamma_generated}
\centering
\subfigure[$\Gamma_{\omega_j \cap \Lambda}$]
{
\input{./graphics/gamma_generated}
}
\qquad \qquad
\subfigure[ $\Gamma_{\omega_j \cap \Lambda} \cap \omega_j$]{
\input{./graphics/intersection}
}
\caption{$\Gamma_{\omega_j \cap \Lambda}$, the portion of $\Gamma$ generated by $\omega_j \cap \Lambda$ in (a) and the intersection between $\Gamma_{\omega_j \cap \Lambda}$ and $\omega_j$ in (b). Here for simplicity $\omega_j$ is represented as a single tetrahedron but actually it is a collection of tetrahedra as shown in Figure \ref{fig:patch}.}
\end{figure}
Thanks to the shape regularity of these extended patches, we have that the following discrete trace and Poincar√®-type inequalites hold. More precisely, for any function $v\in H^1(\omega_j)$, 
\begin{equation}\label{discr_trace_ineq}
\|\trace v\|_{L^2(\Gamma\cap \omega_j)} \lesssim H^{-\frac 12} \|v\|_{L^2(\omega_j)}
\end{equation}
\begin{equation}\label{disc_poincare_ineq}
\|v- \mathcal{E}_{\patch} \pi_L\mtrace v\|_{L^2(\omega_j)} \leq c_P H \|\nabla v\|_{L^2(\omega_j)},
\end{equation}
%where $\pi_L$ is a projection operator onto piecewise constant functions on $\patch\cap \Lambda$. In particular, for any $w \in L^2(\Lambda)$, we define
where for any $w \in L^1(\Lambda)$, $ \mathcal{E}_{\patch}\pi_Lw \in L_h$ and with a little abuse of notation we denote as $\pi_L$ the operator
\begin{equation*}
\pi_Lw_{|\patch \cap \Lambda} =\frac{1}{|\Gamma_{\patch\cap \Lambda}|}\int_{\patch\cap \Lambda}|\DD| w\quad \forall j,
\end{equation*}   
whereas the operator $\mathcal{E}_{\patch}$ simply extends the constant $\pi_L\mtrace v_{|\patch \cap \Lambda}$ to $\omega _j$.
Moreover $\forall u_h \in X^1_{h,0}(\Omega)$ we have the following average inequality 
\begin{equation*}
\sum _j \|\mtrace u_h\|^2_{L^2(\patch \cap \Lambda),|\DD| } \leq \sum _j \|\trace  u_h\|^2_{L^2(\omega_j\cap \Gamma)}.
\end{equation*}
Indeed, by the definition of $\mtrace$ and Jensen inequality, we have
\begin{multline*}
\sum _j \|\mtrace u_h\|^2_{L^2(\patch \cap \Lambda),|\DD| }
= \sum _j\int_{\patch \cap \Lambda} |\DD| \mtrace u_h^2 
\\
= \int_{\Lambda} |\DD| \left( \frac{1}{|\DD|} \int_{\DD} \trace u_h \right)^2
\\
(\text{Jensen})\leq \int_{\Lambda} \int_{\DD} (\trace u_h)^2
= \int_{\Gamma} (\trace u_h)^2
\\
(\patch \cap \Gamma \text{ partition of } \Gamma)= \sum _j \int_{\patch \cap \Gamma} (\trace u_h)^2
= \sum _j \|\trace u_h\|^2_{L^2(\patch \cap \Gamma)}.
\end{multline*}

\begin{lemma}\label{lemma:Lh_infsup}
The space $L_h$ is inf-sup stable, namely $\forall {\lld}_h \in L_h$, $\exists \beta >0$ s.t.
\begin{equation*}
\sup_{\substack{v_h \in X_{h,0}^1(\Omega),\\ {\vd}_h \in X_{h',0}^1(\Lambda)}} \frac{\left(\mtrace v_h - {\vd}_h, {\lld} _h\right)_{\Lambda, |\DD|}}{\vertiii{[v_h, {\vd}_h]}} \geq \beta \|{\lld}_h\|_{H^{-\frac 12}(\Lambda)}.
\end{equation*} 
and the constant is independent of the cuts. 
\end{lemma}
\begin{proof}
% We have to prove that $\exists \beta >0$ such that $\forall l_h \in L_h$,
%\begin{equation*}
%\sup_{\substack{v_h \in X_{h,0}^1(\Omega),\\ {\vd}_h \in X_{h',1}^0(\Lambda)}} \frac{\left(\avrc{T v_h} - {\vd}_h, l _h\right)_{\Lambda, |\DD|}}{\vertiii{[v_h, {\vd}_h]}} \geq \beta \|l_h\|_{H^{-\frac 12}(\Lambda)}.
%\end{equation*}
As in the continuous case, we can choose ${\vd}_h=0$ and we prove that
\begin{equation*} 
\sup_{v_h \in X_{h,0}^1(\Omega)} \frac{\left(\mtrace v_h ,{\lld}_h\right)_{\Lambda, |\DD|}}{\|v_h\|_{H^1(\Omega)}} \geq \beta \|{\lld}_h\|_{H^{-\frac 12}(\Lambda)}.
\end{equation*} 
Proving the last inequality it is equivalent to find the Fortin operator $\pi_F: H^1_0(\Omega) \rightarrow X_{h,0}^1(\Omega)$, such that 
\begin{equation*}
\left(\mtrace v - \mtrace \pi _F v  , {\lld}_h\right)_{\Lambda, |\DD|}=0, \quad \forall v\in H^1_0(\Omega), \, {\lld}_h \in L_h
\end{equation*} 
and
\begin{equation*}
\|\pi_F v\|_{H^1(\Omega)}\lesssim \|v\|_{H^1(\Omega)}.
\end{equation*} 

We define
\begin{equation*}
\pi_F v = I_h v + \sum _j \alpha _j \varphi _j \qquad \text{with }\alpha_j =\frac{\int_{\patch \cap \Lambda}|\DD| (\mtrace v-\mtrace I_h v)}{\int_{\patch \cap \Lambda}|\DD|\mtrace \varphi _j}
\end{equation*}
where $I_h: H^1(\Omega) \rightarrow X_{h,0}^1$ denotes an $H^1(\Omega)$-stable interpolant
and $\varphi_j \in X_{h,0}^1(\Omega)$ is such that supp$(\varphi_j)\subset \omega_j$, supp$(\trace \varphi _j) \subset \Gamma_{\patch\cap \Lambda}\cap \omega_j$, $\varphi_j =0$ on $\partial \omega _j$ and 
\begin{equation}\label{phi_properties}
\int_{\patch\cap \Lambda}|\DD|\mtrace \varphi_j=O(H) \text{ and } \|\nabla \varphi _j\|_{L^2(\omega _j)}=O(1). 
\end{equation}
We notice that supp$(\trace \varphi_j) \subset \Gamma_{\patch\cap \Lambda}\cap \omega_j$ ensures that $\mtrace \varphi_j \subset \omega_j\cap \Lambda$. Therefore, since for construction the interiors of $\omega_j\cap \Lambda$  are disjoint and $\varphi _j = 0 $ on $\partial \omega_j$,  the functions $\mtrace \varphi_j\, \forall j$ have all disjoint supports. This construction is always possible since meas$(\patch) = \mathcal{O}(H^3)$ and diam$(\Gamma_{\patch\cap \Lambda} \cap \omega_j)=\mathcal{O}(H)$, provided $H$ is sufficiently larger that $h$. Indeed, this guarantees that the functions $\varphi _j$ and their traces $\trace \varphi _j$ have a sufficiently large support so that they can be built in order to satisfy \eqref{phi_properties}.
Then we have
\begin{multline*}
\left(\mtrace v - \mtrace \pi _F v  , {\lld}_h\right)_{\Lambda, |\DD|} = \sum _j \int_{\patch\cap \Lambda} |\DD |\left[ \mtrace v-\mtrace I_h v-\sum _i \alpha_i \mtrace \varphi _i \right]{\lld}_h \\
(\text{supp} (\mtrace \varphi _i )\subset \omega _i\cap \Lambda \, \forall i)  =\sum _j \int_{\patch\cap \Lambda}|\DD| \left[ \mtrace v-\mtrace I_h v-\alpha_j \mtrace \varphi _j \right]{\lld}_h\\
=\sum _j \int_{\patch\cap \Lambda} |\DD| (\mtrace v-\mtrace  I_h v) {\lld}_h - \frac{\int_{\patch\cap \Lambda} |\DD| (\mtrace v-\mtrace I_h v)}{\int_{\patch\cap \Lambda}|\DD|\mtrace \varphi _j} \int_{\patch\cap \Lambda} |\DD|\mtrace \varphi _j{\lld}_h\\ 
(\text{using $l_h$ constant on $\patch\cap \Lambda$})=0.
\end{multline*}
Concerning the continuity of $\pi_F$, we exploit the assumptions that the interiors of $\patch$ are disjoint and supp$(\varphi _j) \subset \patch$ and we have
\begin{multline*}
\|\nabla \pi_F v \|_{L^2(\Omega)} \leq \|\nabla I_h v\|_{L^2(\Omega)} + \left(\sum_j\alpha_j^2\|\nabla \varphi _j\|^2_{L^2(\omega_j)}\right)^{\frac 12}\\
(\text{stability of }I_h)\lesssim   \|\nabla  v\|_{L^2(\Omega)} + \left(\sum_j\alpha_j^2\|\nabla \varphi _j\|^2_{L^2(\omega_j)}\right)^{\frac 12}
\end{multline*}
and for the second term 
\begin{multline*}
\sum_j \alpha_j ^2\|\nabla \varphi _j\|^2_{L^2(\omega_j)}\leq
\\
\left(\text{using }\|\nabla \varphi _j\|_{{L^2(\omega_j)}}=O(1)\right) \lesssim  \sum_j \frac{\left(\int_{\patch\cap \Lambda} |\DD| (\mtrace v-\mtrace I_h v)\right)^2}{\left(\int_{\patch\cap \Lambda}|\DD|\mtrace \varphi_j \right)^2}
\\
\left(\text{since }\int_{\patch\cap \Lambda}|\DD|\mtrace \varphi_j=O(H)\right) \lesssim \frac {1}{H^2} \sum_j \left(\int_{\patch\cap \Lambda} |\DD| (\mtrace v-\mtrace I_hv)\right)^2
\\
(\text{Jensen}) \lesssim  \frac {1}{H^2} \sum_j |\patch\cap \Lambda| \int_{\patch\cap \Lambda} |\DD|^2(\mtrace v-\mtrace I_h v)^2
\\
(\text{being }|\patch\cap \Lambda| \leq cH)\lesssim  \frac {1}{H} \sum_j \| \mtrace (v-I_h v)\|^2_{L^2(\patch\cap \Lambda), |\DD|}
\\
(\text{average inequality}) \lesssim  \frac {1}{H} \sum_j \| \trace(v-I_h v)\|^2_{L^2(\omega _j\cap \Gamma)}  
\\
\left(\text{trace inequality} \right)\lesssim  \frac {1}{H^2} \sum_j  \| v-I_h v\|^2_{L^2(\omega_j)} \lesssim  \frac {1}{H^2}  \| v-I_h v\|^2_{L^2(\Omega)} 
\\
(\text{approximation properties of }I_h)\lesssim \|\nabla  v\|^2_{L^2(\Omega)}
\end{multline*}
and the continuity of $\pi_F$ follows.
\end{proof}

%\subparagraph{Satisfaction of the assumptions of the 
%abstract analysis}
We choose the following discrete norm
\begin{equation*}
\vertiii{[u_h, {\ud}_h]}^2_{X_h(\Omega)\times X_{h'}(\Lambda) }
= \|u_h\|^2_{H^1(\Omega)}+\|{\ud}_h\|^2_{H^1(\Lambda),|\D|} + \|\mtrace u_h - {\ud}_h\|^2_{\frac 12, h, \Lambda, |\DD|},
\end{equation*}
where $\|\mtrace u_h - {\ud}_h\|^2_{\frac 12, h, \Lambda, |\DD|} = \|h^{-\frac 12} (\mtrace u_h - {\ud}_h)\|^2_{L^2(\Lambda), |\DD|} $. Then, we have the following lemma. 
\begin{lemma}
The inequalities \eqref{stab_coercivity} and \eqref{stab_stability} hold.
\end{lemma}
\begin{proof} 
Concerning the coercivity property \eqref{stab_coercivity}, we have to show that $\forall [u_h, {\ud}_h]$, there esists $\xi_h \in Q_h$ s.t.
\begin{multline*}
(u_h,u_h)_{H^1(\Omega)}+ ({\ud}_h, {\ud}_h)_{H^1(\Lambda), |\D|} +   (\mtrace u_h - {\ud}_h, \xi_h)_{\Lambda,|\DD|} \\
\geq \alpha_{\xi}(\|u_h\|^2_{H^1(\Omega)}+\|{\ud}_h\|^2_{H^1(\Lambda),|\D|}+ \|\mtrace u_h - {\ud}_h\|^2_{\frac 12, h, \Lambda, |\DD|}.
\end{multline*}
We choose 
\begin{equation*}
{\xi_h}_{|\patch\cap \Lambda}=\delta \frac 1H \pi_L(\mtrace u_h-{\ud}_h)_{|\patch \cap \Lambda}
\end{equation*}
and we recall that 
\begin{equation*}
\pi_L(\mtrace u_h-{\ud}_h)_{|\patch \cap \Lambda}=\frac{1}{|\Gamma_{\patch\cap \Lambda}|}\int_{\patch\cap \Lambda}|\DD| (\mtrace u_h- {\ud}_h).
\end{equation*} 
Actually, $\mathcal{E}_{\patch}\xi_h\in L_h \subset Q_h$. Then,
\begin{multline*}
\left( \mtrace u_h - {\ud}_h, \xi _h \right)_{\Lambda,|\DD|} 
= \sum_j \int_{\patch\cap \Lambda} |\DD|(\mtrace u_h - {\ud}_h)\xi_h
\\
(\text{definition of $\xi_h$})= \delta \frac{1}{H}\sum_j \pi_L( \mtrace u_h - {\ud}_h)\int_{\patch\cap \Lambda} |\DD|(\mtrace u_h - {\ud}_h)
\\
= \delta \frac{1}{H} \sum_j \int_{\patch\cap \Lambda}|\DD| (\pi_L( \mtrace u_h - {\ud}_h) )^2
\\
(\text{orthogonality of $\pi_L$}) = - \delta \frac{1}{H} \|(\pi_L-\mathcal{I})(\mtrace u_h - {\ud}_h)\|^2_{L^2(\patch\cap \Lambda),|\DD|} + \delta \frac{1}{H} \|\mtrace u_h - {\ud}_h\|^2_{L^2(\patch\cap \Lambda),|\DD|}
\\ 
\geq -2\delta \frac 1H \sum_j \|(\pi_L - \mathcal{I})\mtrace u_h\|^2_{L^2(\patch\cap \Lambda), |\DD|}
-2 \delta \frac 1H \sum_j \|(\pi_L - \mathcal{I}){\ud}_h\|^2_{L^2(\patch\cap \Lambda),|\DD|}
\\ 
+ \delta \frac 1H \sum_j \|\mtrace u_h-{\ud}_h\|^2_{L^2(\patch\cap \Lambda),|\DD|}. 
\end{multline*}
For the first term we have
\begin{multline*}
\sum _j  \|(\pi_L - \mathcal{I})\mtrace u_h\|^2_{L^2(\patch\cap \Lambda),|\DD|} =\sum _j \int _{\patch \cap \Lambda} |\DD| (\pi_L \mtrace u_h- \mtrace u_h)^2
\\
(\text{Average inequality)} \leq \sum _j  \int_{\omega _j \cap \Gamma} (\ext \pi_L \mtrace u_h -\trace u_h)^2 
\\
(\text{trace inequality}) \leq \sum _j  \frac 1H \int_{\omega_j}(\mathcal{E}_{\patch} \pi_L \mtrace u_h - u_h)^2 
\\ 
(\text{Poincare, see \cite[Corollary B.65]{MR2050138}})\leq \sum _j  H c_P ^2 \|\nabla u_h\|^2_{L^2(\omega _j)}.
\end{multline*}
For the second term we have
\begin{multline*}
\sum _j \|(\pi_L - \mathcal{I}){\ud}_h\|^2_{L^2(\patch\cap \Lambda),|\DD|} = \sum _j \int_{\patch\cap \Lambda} |\DD| (\pi_L {\ud}_h -{\ud}_h)^2
\\
(\text{Poincare, \cite[Corollary B.65]{MR2050138}})\lesssim \sum _j  H^2 c_P^2 \int_{\patch\cap \Lambda} |\DD|(\nabla {\ud}_h)^2
\\
(\text{since $H$ is fixed, we can find a constant s.t. } H|\DD| \lesssim |\D|) \lesssim \sum _j H c_P^2  \int_{\patch\cap \Lambda} |\D|(\nabla {\ud}_h)^2 
\\
\lesssim \sum _j H c_P^2  \|\nabla {\ud}_h\|^2_{L^2(\patch\cap \Lambda),|\D|}.
\end{multline*}
%{\color{red} N.B. we are using a kind of weigthed Poincare inequality, check... I think it should work because I can do something like this
%\begin{multline*}
%\int_{\patch \cap \Lambda} |\DD| u^2 \leq 
%max |\DD| \int_{\patch \cap \Lambda} u^2 \leq
%max |\DD| \int_{\patch \cap \Lambda} (\nabla u)^2 =
%\frac{max |\DD|}{min|\DD|} min|\DD| \int_{\patch \cap \Lambda} (\nabla u)^2 \leq\\
%\frac{max |\DD|}{min|\DD|}  \int_{\patch \cap \Lambda} |\DD| (\nabla u)^2 
%\end{multline*}
%}\\
Therefore, we obtain
\begin{multline*}
a([u_h, {\ud}_h],[u_h, {\ud}_h] ) + b([u_h, {\ud}_h], \xi_h([u_h, {\ud}_h]))
\geq \\
(1-2\delta c_P^2) \|\nabla u_h\|^2_{L^2(\Omega)} + (1- 2\delta c_P^2) \|\nabla {\ud}_h\|^2_{L^2(\Lambda), |\D|}
+\delta c_H  \|\mtrace u_h-{\ud}_h\|^2_{\frac 12,h,\Lambda, |\DD|}
\end{multline*}
and choosing $\delta=\frac{1}{4c_P^2}$ we obtain the coercivity inequality.\\
Concerning the stability inequality \eqref{stab_stability}, the proof is analogous to the one in \cite{burman2014}.
\end{proof}

\begin{remark}
We notice that if we choose $Q_h=X_{h',0}^1(\Lambda)$, the constant in the inf-sup inequality  \eqref{eq:infsup_discrete} depends on the mesh size $h'$. Indeed,
\begin{multline}
\sup_{\substack{v_h \in X_{h,0}^1(\Omega),\\ {\vd}_h \in X_{h',0}^1(\Lambda)}} \frac{\left(\mtrace v_h - {\vd}_h, {\lld} _h\right)_{\Lambda, |\DD|}}{\vertiii{[v_h, {\vd}_h]}}
\geq \sup_{\substack{{\vd}_h \in X_{h',0}^1(\Lambda)}} \frac{\left(- {\vd}_h, {\lld} _h\right)_{\Lambda, |\DD|}}{\|{\vd}_h\|_{H^1(\Lambda)}}
\geq \frac{{\|\lld} _h\|^2_{L^2(\Lambda)}}{\|{\vd}_h\|_{H^1(\Lambda)}} \\
( \text{inverse inequality} )\geq \frac{{h'}^2}{c_I} \|{\lld}_h\|_{L^2(\Lambda)}
\geq  \frac{{h'}^2}{c_I} \|{\lld}_h\|_{H^{-\frac 12},(\Lambda)}
\end{multline}
being $c_I$ the constant in the inverse inequality
\begin{equation*}
\|{\lld}_h\|_{H^1(\Lambda)} \leq \frac{c_I} {{h'}^2} \|{\lld}_h\|_{L^2(\Lambda)}. 
\end{equation*}
\end{remark}
